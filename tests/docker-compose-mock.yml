version: "3.7"
services:
  localstack:
    image: localstack/localstack:latest
    container_name: localstack
    ports:
      - '53:53'
      - '443:443'
      - '4563-4584:4563-4584'
      - '8055:8080'
      - '${PORT_WEB_UI-8080}:${PORT_WEB_UI-8080}'
    environment:
      - SERVICES=iam,lambda,stepfunctions,sts,cloudwatch,emr,events,ec2,cloudformation,s3,secretsmanager
      - DEBUG=1
      - DISABLE_EVENTS=1
      - LAMBDA_DOCKER_NETWORK=test
      - LOCALSTACK_API_KEY='${LOCALSTACK_API_KEY}'
    volumes:
      - "${TMPDIR:-./localstack}:/tmp/localstack"
      - '/var/run/docker.sock:/var/run/docker.sock'

  mock_server:
    image: mockserver/mockserver:mockserver-5.11.1
    ports:
      - 1080:1080
    environment:
      MOCKSERVER_INITIALIZATION_JSON_PATH: /mock_server/mock_responses.json
    volumes:
      - type: bind
        source: ./files/mock_server
        target: /mock_server

networks:
  default:
    external:
      name: "test"